<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>{{ place if place else "Place Details" }}</title>

  <!-- Font Awesome + Fonts -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Lobster&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet"/>

  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <style>
    /* ===== Body & Background ===== */
    :root{
      --card-bg: rgba(255,255,255,0.08);
      --muted: rgba(255,255,255,0.85);
    }
    html,body{height:100%;margin:0;}
    body{
      margin:0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(-45deg, #141e30, #243b55, #ff512f, #dd2476);
      background-size: 400% 400%;
      animation: bgMove 18s ease infinite;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      overflow:hidden;
      position:relative;
      padding:20px;
    }
    @keyframes bgMove{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }

    /* ===== Floating Icons full-page ===== */
    .tour-icons{
      position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:0;
    }
    .tour-icons i{
      position:absolute;font-size:2.6rem;color:hsl(calc(30*var(--i)),80%,70%);
      opacity:0.28; animation:float 10s ease-in-out infinite;
      text-shadow: 0 0 20px rgba(255,255,255,0.3), 0 0 30px rgba(0,200,255,0.2);
    }
    .tour-icons i:nth-child(odd){ animation-duration:12s; }
    .tour-icons i:nth-child(even){ animation-duration:16s; }

    /* spread positions - full page coverage */
    .tour-icons i:nth-child(1){ top:6%; left:6%; }
    .tour-icons i:nth-child(2){ top:10%; right:10%; }
    .tour-icons i:nth-child(3){ bottom:6%; left:8%; }
    .tour-icons i:nth-child(4){ bottom:10%; right:12%; }
    .tour-icons i:nth-child(5){ top:28%; left:4%; }
    .tour-icons i:nth-child(6){ top:30%; right:6%; }
    .tour-icons i:nth-child(7){ bottom:30%; left:6%; }
    .tour-icons i:nth-child(8){ bottom:26%; right:6%; }
    .tour-icons i:nth-child(9){ top:6%; left:55%; }
    .tour-icons i:nth-child(10){ bottom:6%; right:55%; }
    .tour-icons i:nth-child(11){ top:24%; left:24%; }
    .tour-icons i:nth-child(12){ bottom:24%; right:24%; }
    .tour-icons i:nth-child(13){ top:74%; left:22%; }
    .tour-icons i:nth-child(14){ bottom:74%; right:22%; }
    .tour-icons i:nth-child(15){ top:52%; left:12%; }
    .tour-icons i:nth-child(16){ top:52%; right:12%; }
    .tour-icons i:nth-child(17){ bottom:52%; left:12%; }
    .tour-icons i:nth-child(18){ bottom:52%; right:12%; }

    @keyframes float{
      0% { transform: translateY(0) rotate(0deg); opacity:0.9; }
      50% { transform: translateY(-22px) rotate(8deg); opacity:0.75; }
      100% { transform: translateY(0) rotate(-8deg); opacity:0.9; }
    }

    /* ===== Spotlight behind card ===== */
    .spotlight{
      position:absolute; width:700px; height:700px; background:radial-gradient(circle, rgba(255,255,255,0.12) 0%, transparent 60%);
      filter: blur(80px); z-index:0; pointer-events:none;
    }

    /* ===== Big Card ===== */
    .big-card{
      width:100%;
      max-width:1100px;
      background: var(--card-bg);
      backdrop-filter: blur(14px);
      border-radius:18px;
      padding:20px;
      box-shadow: 0 8px 40px rgba(0,0,0,0.45), 0 0 40px rgba(0,255,255,0.08);
      z-index:2;
      position:relative;
      animation: cardEnter 0.9s cubic-bezier(.2,.9,.2,1) both;
    }
    @keyframes cardEnter{
      from { transform: translateY(12px) scale(.995); opacity:0; }
      to { transform: translateY(0) scale(1); opacity:1; }
    }

    /* ===== Layout: two columns inside card ===== */
    .card-inner { display:flex; gap:20px; align-items:stretch; min-height:420px; }
    .side { flex:1; background: rgba(255,255,255,0.04); border-radius:12px; overflow:hidden; display:flex; flex-direction:column; }
    .left .media-wrap{ padding:0; }
    .media {
      display:block; width:100%; border:0; object-fit:cover;
    }

    /* Image: HD display */
    .place-image {
      width:100%;
      height:auto;
      max-height:420px;
      object-fit:cover; /* cover keeps the frame filled and crisp when images are large */
      border-radius: 10px 10px 0 0;
      box-shadow: 0 8px 30px rgba(0,0,0,0.35);
      background: #111;
    }

    /* Description under image */
    .place-description {
      padding:14px;
      color: #e8f9ff;
      font-size:0.98rem;
      line-height:1.5;
      text-align:justify;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: 0 0 10px 10px;
    }
    .place-description h3{ margin:0 0 8px 0; font-family:'Lobster', cursive; color:#fff; font-size:1.15rem; }

    /* Map fills right side */
    .map-frame { width:100%; height:100%; border:0; min-height:300px; display:block; }

    /* Buttons group: centered under card */
    .button-row { display:flex; justify-content:center; gap:14px; margin-top:18px; }
    .btn {
      display:inline-flex; align-items:center; gap:10px;
      padding:11px 18px; border-radius:10px; text-decoration:none; color:#fff; font-weight:600;
      background: linear-gradient(90deg,#ff512f,#dd2476);
      box-shadow: 0 8px 22px rgba(0,0,0,0.35);
      transition: transform .16s ease, box-shadow .16s ease;
    }
    .btn:hover { transform: translateY(-4px) scale(1.03); box-shadow: 0 16px 40px rgba(0,0,0,0.45); }
    .btn.icon { font-size:1rem; }

    /* Responsive */
    @media (max-width: 980px){
      .card-inner { flex-direction:column; }
      .place-image{ max-height:320px; }
    }

    /* small tweak to ensure readable selects (if any included) */
    select, option {
      color: #fff;
      background: rgba(0,0,0,0.45);
    }
  </style>
</head>
<body>

  <!-- decorative spotlight -->
  <div class="spotlight" aria-hidden="true"></div>

  <!-- floating icons (decorative) -->
  <div class="tour-icons" aria-hidden="true">
    <i class="fa-solid fa-mountain" style="--i:1"></i>
    <i class="fa-solid fa-umbrella-beach" style="--i:2"></i>
    <i class="fa-solid fa-plane" style="--i:3"></i>
    <i class="fa-solid fa-hiking" style="--i:4"></i>
    <i class="fa-solid fa-campground" style="--i:5"></i>
    <i class="fa-solid fa-ship" style="--i:6"></i>
    <i class="fa-solid fa-hotel" style="--i:7"></i>
    <i class="fa-solid fa-binoculars" style="--i:8"></i>
    <i class="fa-solid fa-route" style="--i:9"></i>
    <i class="fa-solid fa-compass" style="--i:10"></i>
    <i class="fa-solid fa-camera-retro" style="--i:11"></i>
    <i class="fa-solid fa-water" style="--i:12"></i>
    <i class="fa-solid fa-tree" style="--i:13"></i>
    <i class="fa-solid fa-tent" style="--i:14"></i>
    <i class="fa-solid fa-bus" style="--i:15"></i>
    <i class="fa-solid fa-bicycle" style="--i:16"></i>
    <i class="fa-solid fa-fire" style="--i:17"></i>
    <i class="fa-solid fa-globe" style="--i:18"></i>
  </div>

  <!-- main cinematic card -->
  <main class="big-card" role="main" aria-labelledby="place-title">

    <div class="card-inner">

      <!-- LEFT: Image + Description -->
      <section class="side left" aria-labelledby="place-title">
        <div class="media-wrap" style="flex:0 0 auto;">
          <img
            id="placeImage"
            class="place-image"
            src="{{ url_for('static', filename='images/' ~ image_file) }}"
            alt="{{ place if place else 'Place image' }}"
            onerror="this.onerror=null; this.src='{{ url_for('static', filename='images/sample.jpg') }}';"
            loading="lazy"
          />
        </div>

        <div class="place-description" role="region" aria-label="Description">
          <h3 id="place-title">{{ place if place else 'Place' }}</h3>
          <p>{{ description if description else 'No description available for this place.' }}</p>
        </div>
      </section>

      <!-- RIGHT: Map -->
      <aside class="side right" aria-label="Map">
        <iframe
          id="mapFrame"
          class="map-frame"
          src="https://www.google.com/maps?q={{ (place|default('')) | urlencode }}&output=embed"
          title="Map for {{ place }}"
          allowfullscreen
          loading="lazy"
        ></iframe>
      </aside>

    </div> <!-- .card-inner -->

    <!-- Buttons -->
    <div class="button-row" role="group" aria-label="Transport links">
      <a class="btn" id="trainBtn" target="_blank" rel="noopener noreferrer">
        <i class="fa-solid fa-train icon" aria-hidden="true"></i> Check Trains
      </a>

      <a class="btn" id="busBtn" href="#" target="_blank" rel="noopener noreferrer">
        <i class="fa-solid fa-bus icon" aria-hidden="true"></i> Check Buses
      </a>

      <a class="btn" id="flightBtn" target="_blank" rel="noopener noreferrer">
        <i class="fa-solid fa-plane icon" aria-hidden="true"></i> Check Flights
      </a>
    </div>

  </main>

  <!-- SCRIPT: wire up transport buttons -->
  <script>
    // Values from Jinja
    const place = {{ (place|tojson) | safe }} || "";
    const state = {{ (state|tojson) | safe }} || "";

    // Train -> IRCTC generic search page (opens new tab)
    const trainBtn = document.getElementById('trainBtn');
    trainBtn.href = "https://www.irctc.co.in/nget/train-search";

    // Flight -> Google Flights / search for flights to place
    const flightBtn = document.getElementById('flightBtn');
    flightBtn.href = "https://www.google.com/search?q=" + encodeURIComponent("flights to " + (place || ""));

    // Bus -> fetch correct state site from backend endpoint and open.
    document.getElementById('busBtn').addEventListener('click', async function (e) {
      e.preventDefault();
      if (!state) {
        // if state missing, try to show helpful message
        return alert("State not provided. Please navigate here using the search form so we can open the correct state bus site.");
      }
      try {
        const res = await fetch(`/get_bus_site?state=${encodeURIComponent(state)}`);
        if (!res.ok) throw new Error("Network error");
        const data = await res.json();
        if (data.url) {
          window.open(data.url, '_blank', 'noopener');
        } else {
          alert("No bus booking site found for: " + state);
        }
      } catch (err) {
        console.error(err);
        alert("Could not fetch bus booking site. Try again later.");
      }
    });
  </script>
</body>
</html>
